# üöÄ PROMPT: T·ªêI ∆ØU H√ìA H·ªÜ TH·ªêNG QU·∫¢N L√ù C·∫§U TR√öC S·∫¢N PH·∫®M

## üéØ M·ª§C TI√äU
T·∫°o m·ªôt h·ªá th·ªëng qu·∫£n l√Ω c·∫•u tr√∫c s·∫£n ph·∫©m th√¥ng minh, t·ªëi ∆∞u v√† d·ªÖ s·ª≠ d·ª•ng cho vi·ªác ƒë·∫∑t t√™n s·∫£n ph·∫©m t·ª± ƒë·ªông.

## üìã Y√äU C·∫¶U HI·ªÜN T·∫†I

### üîç **V·∫•n ƒë·ªÅ hi·ªán t·∫°i:**
- Dropdown danh m·ª•c ch√≠nh kh√¥ng hi·ªÉn th·ªã d·ªØ li·ªáu
- Logic ch·ªçn c·ªôt ph·ª©c t·∫°p v√† kh√≥ hi·ªÉu
- Giao di·ªán ch∆∞a t·ªëi ∆∞u cho UX
- Thi·∫øu validation v√† feedback r√µ r√†ng

### ‚úÖ **Y√™u c·∫ßu c·∫ßn th·ª±c hi·ªán:**
1. **S·ª≠a dropdown danh m·ª•c ch√≠nh** - Hi·ªÉn th·ªã ƒë√∫ng c√°c danh m·ª•c c√≥ `is_primary = true`
2. **ƒê∆°n gi·∫£n h√≥a logic ch·ªçn c·ªôt** - T·∫≠p trung v√†o danh m·ª•c ch√≠nh + c√°c thu·ªôc t√≠nh b·ªï sung
3. **C·∫£i thi·ªán UX/UI** - Giao di·ªán tr·ª±c quan, d·ªÖ hi·ªÉu
4. **Th√™m validation th√¥ng minh** - H∆∞·ªõng d·∫´n ng∆∞·ªùi d√πng t·ª´ng b∆∞·ªõc

---

## üèóÔ∏è KI·∫æN TR√öC H·ªÜ TH·ªêNG MONG MU·ªêN

### üìä **Lu·ªìng ho·∫°t ƒë·ªông:**
```
1. CH·ªåN DANH M·ª§C CH√çNH ‚Üí 2. CH·ªåN THU·ªòC T√çNH B·ªî SUNG ‚Üí 3. X·∫æP TH·ª® T·ª∞ ‚Üí 4. XEM TR∆Ø·ªöC ‚Üí 5. L∆ØU
```

### üé® **Giao di·ªán mong mu·ªën:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üè∑Ô∏è T·∫†O C·∫§U TR√öC S·∫¢N PH·∫®M M·ªöI                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üìÇ DANH M·ª§C CH√çNH (b·∫Øt bu·ªôc)                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ ‚ñæ Lo·∫°i t·ªß b·∫øp ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  üîß THU·ªòC T√çNH B·ªî SUNG (t√πy ch·ªçn)                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ ‚óâ Lo·∫°i nh√¥m         ‚óâ Lo·∫°i tay n·∫Øm              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚óâ Lo·∫°i k√≠nh         ‚óØ B·ªô ph·∫≠n                   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  üìã X·∫æP TH·ª® T·ª∞ C·∫§U TR√öC                                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ 1. Lo·∫°i t·ªß b·∫øp ‚îÄ‚îÄ‚îÄ 2. Lo·∫°i nh√¥m ‚îÄ‚îÄ‚îÄ 3. Lo·∫°i tay‚îÇ   ‚îÇ
‚îÇ  ‚îÇ    ‚ÜïÔ∏è K√©o th·∫£ ƒë·ªÉ s·∫Øp x·∫øp                          ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  üëÄ XEM TR∆Ø·ªöC K·∫æT QU·∫¢                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ üì¶ T√™n s·∫£n ph·∫©m: Lo·∫°i t·ªß b·∫øp - Lo·∫°i nh√¥m - Lo·∫°i ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                    tay n·∫Øm - Lo·∫°i k√≠nh           ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ          [üîÑ ƒê·∫∑t l·∫°i]              [üíæ L∆∞u c·∫•u tr√∫c]    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß CHI TI·∫æT IMPLEMENTATION

### 1. **DATA FLOW & STATE MANAGEMENT**

```typescript
interface StructureWizardState {
  step: 1 | 2 | 3 | 4; // Current step in the wizard
  mainCategory: string | null; // Selected main category ID
  selectedAttributes: string[]; // Selected attribute column IDs
  structureOrder: string[]; // Ordered list of columns for naming
  separator: string; // Separator between parts
  preview: string; // Generated preview name
  validation: ValidationState; // Form validation state
}

interface ValidationState {
  mainCategory: boolean;
  hasAttributes: boolean;
  validStructure: boolean;
  errors: string[];
}
```

### 2. **SMART CATEGORY FILTERING**

```typescript
// Filter logic for main categories
const getMainCategories = (categories: CustomProductCategory[]) => {
  return categories.filter(cat =>
    cat.is_primary === true ||
    cat.is_primary === "true" ||
    cat.name.toLowerCase().includes('ch√≠nh') ||
    cat.description?.toLowerCase().includes('main')
  );
};

// Filter logic for supplementary attributes
const getSupplementaryAttributes = (
  allColumns: Record<string, CustomProductColumn[]>,
  mainCategoryId: string
) => {
  return Object.entries(allColumns)
    .filter(([catId]) => catId !== mainCategoryId)
    .flatMap(([catId, columns]) => columns);
};
```

### 3. **DRAG & DROP FUNCTIONALITY**

```typescript
// Drag and drop for reordering structure
const handleDragEnd = (result: DropResult) => {
  if (!result.destination) return;

  const items = Array.from(structureOrder);
  const [reorderedItem] = items.splice(result.source.index, 1);
  items.splice(result.destination.index, 0, reorderedItem);

  setStructureOrder(items);
  updatePreview(items);
};
```

### 4. **INTELLIGENT PREVIEW GENERATION**

```typescript
const generateSmartPreview = (
  mainCategory: CustomProductCategory,
  attributes: CustomProductColumn[],
  separator: string
): string => {
  // Get first option from each attribute for preview
  const parts = [mainCategory.name];

  attributes.forEach(attr => {
    const firstOption = getFirstOptionForColumn(attr.id);
    if (firstOption) {
      parts.push(firstOption.name);
    }
  });

  return parts.join(separator);
};
```

### 5. **VALIDATION & ERROR HANDLING**

```typescript
const validateStructure = (): ValidationState => {
  const errors: string[] = [];

  if (!mainCategory) {
    errors.push("Vui l√≤ng ch·ªçn danh m·ª•c ch√≠nh");
  }

  if (structureOrder.length === 0) {
    errors.push("Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt thu·ªôc t√≠nh");
  }

  if (!structureOrder.includes(mainCategory!)) {
    errors.push("Danh m·ª•c ch√≠nh ph·∫£i ƒë∆∞·ª£c bao g·ªìm trong c·∫•u tr√∫c");
  }

  return {
    mainCategory: !!mainCategory,
    hasAttributes: structureOrder.length > 0,
    validStructure: errors.length === 0,
    errors
  };
};
```

---

## üé≠ USER EXPERIENCE ENHANCEMENTS

### **Progressive Disclosure**
- **Step 1**: Ch·ªâ hi·ªÉn th·ªã danh m·ª•c ch√≠nh
- **Step 2**: Hi·ªÉn th·ªã thu·ªôc t√≠nh b·ªï sung sau khi ch·ªçn danh m·ª•c ch√≠nh
- **Step 3**: Hi·ªÉn th·ªã t√πy ch·ªçn s·∫Øp x·∫øp sau khi ch·ªçn thu·ªôc t√≠nh
- **Step 4**: Hi·ªÉn th·ªã preview v√† l∆∞u

### **Smart Defaults**
- T·ª± ƒë·ªông th√™m danh m·ª•c ch√≠nh v√†o ƒë·∫ßu c·∫•u tr√∫c
- ƒê·ªÅ xu·∫•t th·ª© t·ª± h·ª£p l√Ω d·ª±a tr√™n lo·∫°i s·∫£n ph·∫©m
- Separator m·∫∑c ƒë·ªãnh l√† " - "

### **Visual Feedback**
- Highlight danh m·ª•c ch√≠nh v·ªõi m√†u kh√°c bi·ªát
- Animation khi th√™m/x√≥a thu·ªôc t√≠nh
- Real-time preview updates
- Progress indicator cho t·ª´ng b∆∞·ªõc

### **Accessibility**
- Keyboard navigation cho drag & drop
- Screen reader support
- High contrast mode
- Focus management

---

## üîó INTEGRATION POINTS

### **Backend API Endpoints**
```
GET  /api/custom-products/categories?is_primary=true
GET  /api/custom-products/categories/{id}/columns
POST /api/custom-products/structures
PUT  /api/custom-products/structures/{id}
```

### **Database Schema Updates**
```sql
-- Ensure is_primary column exists and is properly indexed
ALTER TABLE custom_product_categories
ADD COLUMN IF NOT EXISTS is_primary BOOLEAN DEFAULT FALSE;

CREATE INDEX IF NOT EXISTS idx_categories_is_primary
ON custom_product_categories(is_primary) WHERE is_active = true;
```

### **Related Components**
- `StructureList` - Hi·ªÉn th·ªã danh s√°ch c·∫•u tr√∫c ƒë√£ t·∫°o
- `StructurePreview` - Component preview chi ti·∫øt
- `CategoryManager` - Qu·∫£n l√Ω danh m·ª•c v√† c·ªôt

---

## üìà PERFORMANCE OPTIMIZATIONS

### **Lazy Loading**
- Load categories on demand
- Load column options only when needed
- Virtual scrolling for large lists

### **Caching Strategy**
- Cache category data for 5 minutes
- Cache column options for session
- Invalidate cache on data changes

### **Debounced Updates**
- Debounce preview generation
- Debounce validation checks
- Debounce API calls

---

## üß™ TESTING SCENARIOS

### **Happy Path**
1. User selects main category ‚Üí Attributes appear
2. User selects attributes ‚Üí Reorder interface shows
3. User reorders ‚Üí Preview updates in real-time
4. User saves ‚Üí Success message and redirect

### **Edge Cases**
1. No main categories available ‚Üí Show helpful message
2. Category has no columns ‚Üí Disable selection
3. Network error ‚Üí Retry with exponential backoff
4. Invalid structure ‚Üí Clear validation messages

### **Accessibility Testing**
1. Keyboard-only navigation
2. Screen reader compatibility
3. High contrast mode
4. Mobile responsiveness

---

## üöÄ DEPLOYMENT CHECKLIST

- [ ] Backend: Update API to filter primary categories
- [ ] Database: Ensure is_primary column exists
- [ ] Frontend: Implement new StructureWizard component
- [ ] Testing: Unit tests for all new functions
- [ ] E2E: Test complete user flows
- [ ] Performance: Load testing for category/column loading
- [ ] Documentation: Update user guides

---

## üí° FUTURE ENHANCEMENTS

1. **AI-Powered Suggestions**: ƒê·ªÅ xu·∫•t c·∫•u tr√∫c d·ª±a tr√™n s·∫£n ph·∫©m t∆∞∆°ng t·ª±
2. **Template System**: L∆∞u v√† t√°i s·ª≠ d·ª•ng c·∫•u tr√∫c m·∫´u
3. **Bulk Operations**: T·∫°o nhi·ªÅu c·∫•u tr√∫c c√πng l√∫c
4. **Analytics**: Theo d√µi vi·ªác s·ª≠ d·ª•ng c·∫•u tr√∫c
5. **Import/Export**: Xu·∫•t c·∫•u tr√∫c ra file Excel/CSV

---

*Prompt n√†y ƒë∆∞·ª£c t·∫°o ƒë·ªÉ h∆∞·ªõng d·∫´n vi·ªác ph√°t tri·ªÉn m·ªôt h·ªá th·ªëng qu·∫£n l√Ω c·∫•u tr√∫c s·∫£n ph·∫©m t·ªëi ∆∞u, t·∫≠p trung v√†o tr·∫£i nghi·ªám ng∆∞·ªùi d√πng v√† hi·ªáu su·∫•t.*






